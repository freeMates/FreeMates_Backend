<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/masterLayout}">
<head>
  <title>회원가입 - Step 3</title>
</head>
<body>
<div layout:fragment="content">
  <h2 class="text-center mb-4">이메일 인증</h2>
  <form id="signup-step3-form">
    <div class="input-group mb-3">
      <input type="email" id="email" name="email" class="form-control" placeholder="이메일을 입력해주세요." required>
      <button type="button" id="sendEmailBtn" class="btn">이메일 전송</button>
    </div>
    <div id="timer" style="display: none;">3:00</div>
    <div class="input-group mb-3">
      <input type="text" id="verificationCode" name="verificationCode" class="form-control" placeholder="인증 코드를 입력해주세요." required>
    </div>
    <button type="button" class="btn btn-custom w-100" disabled>이메일 확인</button>
  </form>

  <script th:inline="javascript">
    $(document).ready(function () {
      // 초기화 (필요 시 추가)
      // init();

      // 데이터 초기화
      initData();

      // 이벤트 처리
      eventHandler();
    });

    function initData() {
      // 데이터 초기화 로직 (필요 시 추가)
    }

    function eventHandler() {
      $('#sendEmailBtn').click(function() {
        $.ajax({
          url: '/api/send-email',
          method: 'POST',
          data: { email: $('#email').val() },
          success: function() {
            let time = 180;
            $('#timer').show();
            let timerInterval = setInterval(function() {
              let minutes = Math.floor(time / 60);
              let seconds = time % 60;
              $('#timer').text(minutes + ':' + (seconds < 10 ? '0' : '') + seconds);
              time--;
              if (time < 0) {
                clearInterval(timerInterval);
                $('#timer').text('시간 초과');
              }
            }, 1000);
          }
        });
      });

      $('#verificationCode').on('input', function() {
        if ($(this).val().length > 0) {
          $('.btn-custom').prop('disabled', false);
        }
      });
    }
  </script>
</div>
<div layout:fragment="footer"></div> <!-- 푸터 비활성화 -->
</body>
</html>